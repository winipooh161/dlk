import"./index.esm2017-NZQW5Whv.js";import{s as C}from"./firebase-init-DbTOy2-U.js";import{f as M,a as I,r as k}from"./chat-utils-CE2qhhRJ.js";function w(h){const f=h.parentElement,l=document.createElement("button"),i=document.createElement("div");l.textContent="üòâ",l.type="button",l.classList.add("emoji-button"),i.classList.add("emoji-picker"),i.style.position="absolute";const r={recent:[],smileys:["üòÄ","üòÅ","üòÇ","ü§£","üòÉ","üòÑ","üòÖ","üòÜ","üòâ","üòä","üòç","üòò","üòú","üòé","üò≠","üò°"],emotions:["üòá","üòà","üôÉ","ü§î","üò•","üòì","ü§©","ü•≥","ü§Ø","ü§¨","üò±","üò¥","ü•∞","üòù","ü§ó","üò∂"],animals:["üê±","üê∂","üê≠","üêπ","üê∞","ü¶ä","üêª","üêº","ü¶Å","üêÆ","üê∑","üê∏","üêµ","üêî","üêß","üê¶"],plants:["üåπ","üåª","üå∫","üå∑","üåº","üçÄ","üåø","üå¥","üåµ","üå≤","üå≥","üçÑ","üåæ","üçÅ","üçÇ","üçÉ"],food:["üçé","üçì","üçí","üçá","üçâ","üçã","üçä","üçå","ü•ù","üçç","ü•≠","üçï","üçî","üåÆ","üç£","üç©"],objects:["üì±","üíª","üì∑","üîã","üí°","üéÅ","‚öΩ","üèÄ","üéÆ","üéß","üìö","üîë","üí∞","‚è∞","üîç","üîí"]};try{const n=localStorage.getItem("recentEmojis");n&&(r.recent=JSON.parse(n).slice(0,10))}catch(n){console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏ —ç–º–æ–¥–∑–∏:",n),r.recent=[]}function E(n){r.recent=r.recent.filter(c=>c!==n),r.recent.unshift(n),r.recent.length>10&&r.recent.pop();try{localStorage.setItem("recentEmojis",JSON.stringify(r.recent))}catch(c){console.error("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏ —ç–º–æ–¥–∑–∏:",c)}b()}function b(){const n=i.querySelector('.emoji-category[data-category="recent"]');if(n){const c=n.querySelector(".emoji-content");r.recent.length===0?c.innerHTML='<div class="emoji-empty-message">–ó–¥–µ—Å—å –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –≤–∞—à–∏ –Ω–µ–¥–∞–≤–Ω–∏–µ —ç–º–æ–¥–∑–∏</div>':(c.innerHTML="",r.recent.forEach(d=>{const y=document.createElement("span");y.classList.add("emoji-item"),y.textContent=d,c.appendChild(y)}))}}let m='<div class="emoji-tabs">';const j={recent:"–ù–µ–¥–∞–≤–Ω–∏–µ",smileys:"–°–º–∞–π–ª–∏–∫–∏",emotions:"–≠–º–æ—Ü–∏–∏",animals:"–ñ–∏–≤–æ—Ç–Ω—ã–µ",plants:"–†–∞—Å—Ç–µ–Ω–∏—è",food:"–ï–¥–∞",objects:"–û–±—ä–µ–∫—Ç—ã"};Object.keys(r).forEach((n,c)=>{m+=`<div class="emoji-tab ${c===0?"active":""}" data-category="${n}">${j[n]}</div>`}),m+='</div><div class="emoji-categories">',Object.keys(r).forEach((n,c)=>{m+=`<div class="emoji-category ${c===0?"active":""}" data-category="${n}">`,m+='<div class="emoji-content">',n==="recent"&&r.recent.length===0?m+='<div class="emoji-empty-message">–ó–¥–µ—Å—å –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –≤–∞—à–∏ –Ω–µ–¥–∞–≤–Ω–∏–µ —ç–º–æ–¥–∑–∏</div>':r[n].forEach(d=>{m+=`<span class="emoji-item">${d}</span>`}),m+="</div></div>"}),m+="</div>",i.innerHTML=m,i.querySelectorAll(".emoji-tab").forEach(n=>{n.addEventListener("click",()=>{const c=n.getAttribute("data-category");i.querySelectorAll(".emoji-tab").forEach(d=>d.classList.remove("active")),n.classList.add("active"),i.querySelectorAll(".emoji-category").forEach(d=>{d.classList.remove("active"),d.getAttribute("data-category")===c&&d.classList.add("active")})})}),i.addEventListener("click",n=>{if(n.target.classList.contains("emoji-item")){const c=n.target.textContent,d=h.selectionStart,y=h.value.substring(0,d),p=h.value.substring(d);h.value=y+c+p;const L=d+c.length;h.selectionStart=L,h.selectionEnd=L,h.focus(),E(c)}});const g=document.createElement("style");g.textContent=`
      
    `,document.head.appendChild(g),f.appendChild(l),f.appendChild(i),i.style.display="none",l.addEventListener("click",n=>{n.stopPropagation(),i.style.display=i.style.display==="none"?"flex":"none"}),document.addEventListener("click",n=>{!i.contains(n.target)&&!l.contains(n.target)&&(i.style.display="none")})}document.addEventListener("DOMContentLoaded",()=>{if("Notification"in window&&Notification.permission!=="granted"&&Notification.permission!=="denied"){const s=document.createElement("div");s.className="notification-permission-banner",s.innerHTML=`
            <div class="notification-banner-content">
                <p>–†–∞–∑—Ä–µ—à–∏—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è, —á—Ç–æ–±—ã –±—ã—Ç—å –≤ –∫—É—Ä—Å–µ –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π</p>
                <button id="allow-notifications" class="btn btn-primary">–†–∞–∑—Ä–µ—à–∏—Ç—å</button>
                <button id="close-notification-banner" class="btn btn-secondary">–ü–æ–∑–∂–µ</button>
            </div>
        `,document.body.appendChild(s),document.getElementById("allow-notifications").addEventListener("click",()=>{Notification.requestPermission().then(e=>{console.log("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å "+(e==="granted"?"—Ä–∞–∑—Ä–µ—à–∏–ª":"–Ω–µ —Ä–∞–∑—Ä–µ—à–∏–ª")+" —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è"),s.remove()})}),document.getElementById("close-notification-banner").addEventListener("click",()=>{s.remove()})}const h=window.Laravel.user.id,f=document.querySelector('meta[name="csrf-token"]').getAttribute("content");let l=null,i=null,r=new Set,E=!1;function b(s,e){l=s,i=e;const t=document.getElementById("chat-messages").querySelector("ul");t.innerHTML="",r.clear();const o=document.querySelector(`[data-chat-id="${s}"][data-chat-type="${e}"] h5`),v=document.getElementById("chat-header");v.textContent=o?o.textContent:"–í—ã–±–µ—Ä–∏—Ç–µ —á–∞—Ç –¥–ª—è –æ–±—â–µ–Ω–∏—è",fetch(`/chats/${e}/${s}/messages`).then(u=>{if(!u.ok)throw new Error("Network response was not ok");return u.json()}).then(u=>{if(r.clear(),u.messages&&u.messages.length>0){const S=u.messages[u.messages.length-1];window.lastLoadedMessageId=S.id}k(u.messages,h,r,f,i,l),j(s,e)}).catch(u=>{console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π:",u)})}function m(){if(!l||!p.value.trim()&&!document.querySelector(".file-input").files[0])return;const s=p.value.trim(),a=document.querySelector(".file-input").files;let t=new FormData;t.append("message",s);for(let o=0;o<a.length;o++)t.append("files[]",a[o]);fetch(`/chats/${i}/${l}/messages`,{method:"POST",headers:{"X-CSRF-TOKEN":f},body:t}).then(o=>o.ok?o.json():o.text().then(v=>{throw new Error(v)})).then(o=>{o.message&&(k([o.message],o.message.sender_id,r,f,i,l),p.value="",document.querySelector(".file-input").value="",o.message.receiver&&o.message.receiver.firebase_token&&C(o.message.receiver.firebase_token,"–ù–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ",o.message.message,{chatId:l,chatType:i,messageId:o.message.id}))}).catch(o=>console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è:",o))}function j(s,e){fetch(`/chats/${e}/${s}/mark-read`,{method:"POST",headers:{"X-CSRF-TOKEN":f}}).catch(a=>console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–º–µ—Ç–∫–µ —Å–æ–æ–±—â–µ–Ω–∏–π –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö:",a))}setInterval(()=>{if(l&&i){const s=document.getElementById("chat-messages");if(!s||!s.querySelector("ul"))return;const a=window.lastLoadedMessageId||0;fetch(`/chats/${i}/${l}/new-messages`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":f},body:JSON.stringify({last_message_id:a})}).then(t=>{if(!t.ok)throw new Error("Network response was not ok");return t.json()}).then(t=>{if(t.messages&&t.messages.length>0){const o=t.messages[t.messages.length-1];window.lastLoadedMessageId=o.id,k(t.messages,t.current_user_id,r,f,i,l),j(l,i)}}).catch(t=>{console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π:",t)})}},1e3);const g=document.getElementById("chat-list");g&&g.addEventListener("click",s=>{const e=s.target.closest("li");if(!e)return;const a=e.getAttribute("data-chat-id"),t=e.getAttribute("data-chat-type");l===a&&i===t||b(a,t)});const n=document.getElementById("search-chats"),c=document.getElementById("search-results");n&&n.addEventListener("input",function(){const s=n.value.trim().toLowerCase();s===""?(c.style.display="none",Array.from(g.children).forEach(e=>{e.style.display="flex"})):(Array.from(g.children).forEach(e=>{const a=e.querySelector("h5").textContent.toLowerCase();e.style.display=a.includes(s)?"flex":"none"}),fetch("/chats/search",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":f},body:JSON.stringify({query:s})}).then(e=>e.json()).then(e=>{let a="";e.chats&&e.chats.length>0&&(a+="<h5>–ß–∞—Ç—ã</h5><ul>",e.chats.forEach(t=>{a+=`<li data-chat-id="${t.id}" data-chat-type="${t.type}">${t.name}</li>`}),a+="</ul>"),e.messages&&e.messages.length>0&&(a+="<h5>–°–æ–æ–±—â–µ–Ω–∏—è</h5><ul>",e.messages.forEach(t=>{let o=t.chat_id,v="group";o||(v="personal",o=t.sender_id==h?t.receiver_id:t.sender_id),a+=`<li data-chat-id="${o}" data-chat-type="${v}" data-message-id="${t.id}">
                                <strong>${t.sender_name}:</strong> ${t.message.substring(0,50)}...
                                <br><small>${M(t.created_at)}</small>
                            </li>`}),a+="</ul>"),c.innerHTML=a,c.style.display=a.trim()===""?"none":"block",Array.from(c.querySelectorAll("li")).forEach(t=>{t.addEventListener("click",function(){const o=this.getAttribute("data-chat-id"),v=this.getAttribute("data-chat-type"),u=this.getAttribute("data-message-id");b(o,v),n.value="",c.style.display="none",u&&setTimeout(()=>{},1e3)})})}).catch(e=>console.error("–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞:",e)))});function d(){const s=document.querySelector(".attach-file"),e=document.querySelector(".file-input");s&&e&&(s.addEventListener("click",()=>{e.click()}),e.addEventListener("change",()=>{e.files.length>0&&m()}))}document.readyState!=="loading"?d():document.addEventListener("DOMContentLoaded",d);const y=document.getElementById("send-message"),p=document.getElementById("chat-message");y&&y.addEventListener("click",m),p&&p.addEventListener("keypress",s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),m())}),w(p),document.addEventListener("DOMContentLoaded",()=>{const s=g?g.querySelector("li"):null;s&&s.click()});const L=document.getElementById("toggle-pinned");L&&L.addEventListener("click",()=>{E=!E,L.textContent=E?"–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è":"–ü–æ–∫–∞–∑–∞—Ç—å —Ç–æ–ª—å–∫–æ –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–Ω—ã–µ",I(E)})});
