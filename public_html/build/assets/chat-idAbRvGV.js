import"./index.esm2017-NZQW5Whv.js";import"./firebase-init-WlDQV2z_.js";import{f as C,a as I,r as b}from"./notification-Unum4wLs.js";function S(l){const d=l.parentElement,a=document.createElement("button"),o=document.createElement("div");a.textContent="üòâ",a.type="button",a.classList.add("emoji-button"),o.classList.add("emoji-picker"),o.style.position="absolute",o.style.bottom="50px",o.style.left="10px";const f=["üòÄ","üòÅ","üòÇ","ü§£","üòÉ","üòÑ","üòÖ","üòÜ","üòâ","üòä","üòç","üòò","üòú","üòé","üò≠","üò°","üòá","üòà","üôÉ","ü§î","üò•","üòì","ü§©","ü•≥","ü§Ø","ü§¨","ü§°","üëª","üíÄ","üëΩ","ü§ñ","üéÉ","üê±","üê∂","üê≠","üêπ","üê∞","ü¶ä","üêª","üêº","ü¶Å","üêÆ","üê∑","üê∏","üêµ","üêî","üêß","üê¶","üåπ","üåª","üå∫","üå∑","üåº","üçé","üçì","üçí","üçá","üçâ","üçã","üçä","üçå","ü•ù","üçç","ü•≠"];let g="";f.forEach(c=>{g+=`<span class="emoji-item">${c}</span>`}),o.innerHTML=g,o.addEventListener("click",c=>{if(c.target.classList.contains("emoji-item")){const y=c.target.textContent,p=l.selectionStart,u=l.value.substring(0,p),E=l.value.substring(p);l.value=u+y+E;const m=p+y.length;l.selectionStart=m,l.selectionEnd=m,l.focus()}}),d.appendChild(a),d.appendChild(o),o.style.display="none",a.addEventListener("click",c=>{c.stopPropagation(),o.style.display=o.style.display==="none"?"flex":"none"}),document.addEventListener("click",c=>{!o.contains(c.target)&&!a.contains(c.target)&&(o.style.display="none")})}document.addEventListener("DOMContentLoaded",()=>{if("Notification"in window&&Notification.permission!=="granted"&&Notification.permission!=="denied"){const n=document.createElement("div");n.className="notification-permission-banner",n.innerHTML=`
            <div class="notification-banner-content">
                <p>–†–∞–∑—Ä–µ—à–∏—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è, —á—Ç–æ–±—ã –±—ã—Ç—å –≤ –∫—É—Ä—Å–µ –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π</p>
                <button id="allow-notifications" class="btn btn-primary">–†–∞–∑—Ä–µ—à–∏—Ç—å</button>
                <button id="close-notification-banner" class="btn btn-secondary">–ü–æ–∑–∂–µ</button>
            </div>
        `,document.body.appendChild(n),document.getElementById("allow-notifications").addEventListener("click",()=>{Notification.requestPermission().then(e=>{console.log("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å "+(e==="granted"?"—Ä–∞–∑—Ä–µ—à–∏–ª":"–Ω–µ —Ä–∞–∑—Ä–µ—à–∏–ª")+" —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è"),n.remove()})}),document.getElementById("close-notification-banner").addEventListener("click",()=>{n.remove()})}const l=window.Laravel.user.id,d=document.querySelector('meta[name="csrf-token"]').getAttribute("content");let a=null,o=null,f=new Set,g=!1;function c(n,e){a=n,o=e;const t=document.getElementById("chat-messages").querySelector("ul");t.innerHTML="",f.clear();const s=document.querySelector(`[data-chat-id="${n}"][data-chat-type="${e}"] h5`),h=document.getElementById("chat-header");h.textContent=s?s.textContent:"–í—ã–±–µ—Ä–∏—Ç–µ —á–∞—Ç –¥–ª—è –æ–±—â–µ–Ω–∏—è",fetch(`/chats/${e}/${n}/messages`).then(r=>{if(!r.ok)throw new Error("Network response was not ok");return r.json()}).then(r=>{if(f.clear(),r.messages&&r.messages.length>0){const w=r.messages[r.messages.length-1];window.lastLoadedMessageId=w.id}b(r.messages,l,f,d,o,a),p(n,e)}).catch(r=>{console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π:",r)})}function y(){if(!a||!L.value.trim()&&!document.querySelector(".file-input").files[0])return;const n=L.value.trim(),i=document.querySelector(".file-input").files;let t=new FormData;t.append("message",n);for(let s=0;s<i.length;s++)t.append("files[]",i[s]);fetch(`/chats/${o}/${a}/messages`,{method:"POST",headers:{"X-CSRF-TOKEN":d},body:t}).then(s=>s.ok?s.json():s.text().then(h=>{throw new Error(h)})).then(s=>{s.message&&(b([s.message],s.message.sender_id,f,d,o,a),L.value="",document.querySelector(".file-input").value="")}).catch(s=>console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è:",s))}function p(n,e){fetch(`/chats/${e}/${n}/mark-read`,{method:"POST",headers:{"X-CSRF-TOKEN":d}}).catch(i=>console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–º–µ—Ç–∫–µ —Å–æ–æ–±—â–µ–Ω–∏–π –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö:",i))}setInterval(()=>{if(a&&o){const n=document.getElementById("chat-messages");if(!n||!n.querySelector("ul"))return;const i=window.lastLoadedMessageId||0;fetch(`/chats/${o}/${a}/new-messages`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":d},body:JSON.stringify({last_message_id:i})}).then(t=>{if(!t.ok)throw new Error("Network response was not ok");return t.json()}).then(t=>{if(t.messages&&t.messages.length>0){const s=t.messages[t.messages.length-1];window.lastLoadedMessageId=s.id,b(t.messages,t.current_user_id,f,d,o,a),p(a,o)}}).catch(t=>{console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π:",t)})}},1e3);const u=document.getElementById("chat-list");u&&u.addEventListener("click",n=>{const e=n.target.closest("li");if(!e)return;const i=e.getAttribute("data-chat-id"),t=e.getAttribute("data-chat-type");a===i&&o===t||c(i,t)});const E=document.getElementById("search-chats"),m=document.getElementById("search-results");E&&E.addEventListener("input",function(){const n=E.value.trim().toLowerCase();n===""?(m.style.display="none",Array.from(u.children).forEach(e=>{e.style.display="flex"})):(Array.from(u.children).forEach(e=>{const i=e.querySelector("h5").textContent.toLowerCase();e.style.display=i.includes(n)?"flex":"none"}),fetch("/chats/search",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":d},body:JSON.stringify({query:n})}).then(e=>e.json()).then(e=>{let i="";e.chats&&e.chats.length>0&&(i+="<h5>–ß–∞—Ç—ã</h5><ul>",e.chats.forEach(t=>{i+=`<li data-chat-id="${t.id}" data-chat-type="${t.type}">${t.name}</li>`}),i+="</ul>"),e.messages&&e.messages.length>0&&(i+="<h5>–°–æ–æ–±—â–µ–Ω–∏—è</h5><ul>",e.messages.forEach(t=>{let s=t.chat_id,h="group";s||(h="personal",s=t.sender_id==l?t.receiver_id:t.sender_id),i+=`<li data-chat-id="${s}" data-chat-type="${h}" data-message-id="${t.id}">
                                <strong>${t.sender_name}:</strong> ${t.message.substring(0,50)}...
                                <br><small>${C(t.created_at)}</small>
                            </li>`}),i+="</ul>"),m.innerHTML=i,m.style.display=i.trim()===""?"none":"block",Array.from(m.querySelectorAll("li")).forEach(t=>{t.addEventListener("click",function(){const s=this.getAttribute("data-chat-id"),h=this.getAttribute("data-chat-type"),r=this.getAttribute("data-message-id");c(s,h),E.value="",m.style.display="none",r&&setTimeout(()=>{},1e3)})})}).catch(e=>console.error("–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞:",e)))});function k(){const n=document.querySelector(".attach-file"),e=document.querySelector(".file-input");n&&e&&(n.addEventListener("click",()=>{e.click()}),e.addEventListener("change",()=>{e.files.length>0&&y()}))}document.readyState!=="loading"?k():document.addEventListener("DOMContentLoaded",k);const M=document.getElementById("send-message"),L=document.getElementById("chat-message");M&&M.addEventListener("click",y),L&&L.addEventListener("keypress",n=>{n.key==="Enter"&&!n.shiftKey&&(n.preventDefault(),y())}),S(L),document.addEventListener("DOMContentLoaded",()=>{const n=u?u.querySelector("li"):null;n&&n.click()});const v=document.getElementById("toggle-pinned");v&&v.addEventListener("click",()=>{g=!g,v.textContent=g?"–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è":"–ü–æ–∫–∞–∑–∞—Ç—å —Ç–æ–ª—å–∫–æ –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–Ω—ã–µ",I(g)})});
